R={},R.images=[{size:1.8,id:"bat",src:"img/bat.png?121"},{size:352.38,id:"bg",src:"img/bg.png?121"},{size:14.51,id:"billd_mc",src:"img/billd_mc.png?121"},{size:2.57,id:"door",src:"img/door.png?121"},{size:1.26,id:"fish",src:"img/fish.png?121"},{size:11.71,id:"run0",src:"img/run0.png?121"},{size:.26,id:"snail",src:"img/snail.png?121"},{size:2.97,id:"spider",src:"img/spider.png?121"},{size:.69,id:"spring",src:"img/spring.png?121"},{size:.48,id:"star",src:"img/star.png?121"},{size:1.13,id:"yellow_ball",src:"img/yellow_ball.png?121"}];var mapData={shape:{rect:[{color:"#9fee00f9",x:2034.5,y:176.75,width:638.35,height:622.55},{color:"#c7f66ff9",x:21.35,y:495.9,width:363.35,height:304.1},{color:"#008209f9",x:143.55,y:461.85,width:98,height:34.05},{color:"#9fee00f9",x:216.05,y:594.3,width:259.2,height:206},{color:"#86b32df9",x:105.55,y:728.95,width:1389.3,height:71.05},{color:"#679b00f9",x:755.05,y:694.9,width:676.1,height:34.05},{color:"#679b00f9",x:836.75,y:660.85,width:539.6,height:34.05},{color:"#679b00f9",x:913.45,y:626.8,width:427.25,height:34.05},{color:"#679b00f9",x:970.55,y:591.6,width:335.65,height:34.05},{color:"#679b00f9",x:1021.6,y:556.95,width:229.3,height:34.05},{color:"#86b32df9",x:2171.45,y:365.9,width:578.3,height:435.85},{color:"#c7f66ff9",x:1615.45,y:479.25,width:1390.75,height:321.05},{color:"#14d100f9",x:2131.25,y:422.15,width:235.2,height:57.25}]},mc:{player:[{x:63.85,y:490.5}],star:[{x:567.9,y:699.45},{x:788.4,y:665.15},{x:676.4,y:699.45},{x:989.55,y:562.25},{x:878.45,y:631.95},{x:938.95,y:596.6},{x:1045.25,y:528.45},{x:1097.35,y:528.45},{x:1149.45,y:528.45},{x:506.8,y:653.5},{x:506.8,y:480.7},{x:506.8,y:394.35},{x:506.8,y:308},{x:506.8,y:567.05},{x:1201.55,y:528.45},{x:236.25,y:562.25},{x:151.3,y:694.9},{x:2211.65,y:335.6},{x:2511.95,y:335.6},{x:2411.85,y:335.6},{x:2311.75,y:335.6},{x:2612.05,y:335.6},{x:2712.1,y:335.6},{x:2831.1,y:22.7},{x:2831.1,y:148.65},{x:2831.1,y:274.6},{x:2831.1,y:400.6}],spring:[{x:496.4,y:727.5},{x:1448.95,y:727.65},{x:2823.85,y:478.7}],spider:[{x:354,y:578.75},{x:668.3,y:596.55},{x:933.2,y:413.45},{x:1160.6,y:686.95},{x:1198.45,y:587.2},{x:1171.05,y:497.4},{x:330.6,y:433.75},{x:197.2,y:298.4},{x:260.55,y:714.5},{x:2525.45,y:473.65},{x:2244.95,y:416.15},{x:2475.9,y:357.4},{x:2268.95,y:169.4},{x:1816,y:471.4}],yellow_ball:[{x:1124.15,y:439.35},{x:952.55,y:467.95},{x:782.75,y:524.8},{x:495.8,y:644.45},{x:224,y:438.75},{x:172.3,y:422.45}],fish:[{x:1542.4,y:756.25}],door:[{x:182.15,y:382.4}]},map:{width:3e3,height:800},hit:{lines:[[{x:2131.25,y:422.15},{x:2366.45,y:422.15}],[{x:1022.85,y:557.55},{x:1250.95,y:557.55}],[{x:143.55,y:461.85},{x:241.55,y:461.85}],[{x:21.35,y:495.9},{x:384.7,y:495.9}],[{x:216.05,y:594.3},{x:475.25,y:594.3}],[{x:105.55,y:728.95},{x:1494.85,y:728.95}],[{x:755.2,y:694.9},{x:1431.3,y:694.9}],[{x:837.55,y:660.85},{x:1376.3,y:660.85}],[{x:914.15,y:626.8},{x:1340.15,y:626.8}],[{x:971.55,y:591.6},{x:1306.45,y:591.6}],[{x:1615.45,y:479.25},{x:3006.25,y:479.25}],[{x:2034.5,y:176.75},{x:2672.85,y:176.75}],[{x:2171.45,y:365.9},{x:2748.85,y:365.9}]],beziers:[]},floor:[{name:"floor1",data:[{x:149.05,y:418.65},{x:577.1,y:418.65},{x:593.1,y:650.7},{x:729.2,y:660.6},{x:928.4,y:482.75},{x:1410.5,y:433.75}]},{name:"floor1",data:[{x:1274.9,y:534.45},{x:1516.9,y:530.45},{x:1512.9,y:140.5},{x:1911.85,y:140.5}]},{name:"floor1",data:[{x:2037.85,y:125.5},{x:2548.8,y:54.5}]}]};!function(win){var ns=FL.ns("billd");eval(FL.import("FL","Utils, Canvas"));var speedx=2,speedy=2,Floor=ns.Floor=function(t,i,s){i=i||84,s=s||9,Canvas.call(this,0,0),this.cacheCtx.save(),this.cacheCtx.fillStyle="#BF8230",this.cacheCtx.fillRect(0,0,i,s),this.cacheCtx.strokeRect(0,0,i,s),this.cacheCtx.restore(),this.setImage(i,s),this.init(t)};Utils.extends(Floor,Canvas),Floor.prototype.init=function(t){this.points=t.data.map(function(t){return new Vector(t.x,t.y)}),this.points=this.points.concat(this.points.slice(1,-1).reverse()),this.length=this.points.length,this.pos=new Vector(this.points[0].x,this.points[0].y),this.v=new Vector,this.setState(1)},Floor.prototype.setState=function(t){this.state=t%this.length,this.point=this.points[this.state],this.dis=this.point.minusNew(this.points[(this.state+this.length-1)%this.length]),this.v.x=0==this.dis.x?0:this.dis.x>0?speedx:-speedy,this.v.y=0==this.dis.y?0:this.dis.y>0?speedy:-speedy},Floor.prototype.update=function(){this.x=this.pos.x+ns.map.x,this.y=this.pos.y+ns.map.y,this.pos.plus(this.v),(this.dis.x>0&&this.pos.x>=this.point.x||this.pos.x<=this.point.x&&this.dis.x<0)&&(this.v.x=0,this.pos.x=this.point.x),(this.dis.y>0&&this.pos.y>=this.point.y||this.pos.y<=this.point.y&&this.dis.y<0)&&(this.v.y=0,this.pos.y=this.point.y),0==this.v.x&&0==this.v.y&&this.setState(this.state+1)}}(window);var ns=FL.ns("billd");eval(FL.import("FL","Utils, MovieClip, Keyboard"));var speed1=2,speed2=3.5,jumpSpeed=-6,maxSpeed=7,g=.2,idleActions=["play1","play2","play3","stand1","attack","stand3"],IDLE_TIME=300,Player=ns.Player=function(){MovieClip.apply(this,arguments),this.action="stand2",this.time=0,this.pos=new Vector,this.v=new Vector,this.a=new Vector(0,g),this.alive=!0,this.idle=!1,this.idleTime=0,this.idleAction=idleActions[0],this.floorV=0};Utils.extends(Player,MovieClip),Player.prototype.init=function(){this.addAnimation("stand3","0-5",!0,6),this.addAnimation("stand2","6-11",!0,6),this.addAnimation("stand1","12-19",!0,6),this.addAnimation("run2","20-23",!0,4),this.addAnimation("run1","24-29",!0,6),this.addAnimation("swim","30-35 ",!0,6),this.addAnimation("play1","40-54",!0,6),this.addAnimation("play2","55-59",!0,6),this.addAnimation("play3","88-93",!0,6),this.addAnimation("jump2","60-70",!1,8),this.addAnimation("jump1","71-77",!1,6),this.addAnimation("attack","80-87",!0,6),this.setImg(R.images.billd_mc,22,22),this.originX=this.width>>1,this.originY=this.height,this.bounds=this.getBounds()},Player.prototype.keyAction=function(){Math.abs(this.a.x)<.001&&Keyboard.getIsDown("LEFT")?(this.v.x=Keyboard.getKeyDelay("LEFT")<300?-1*speed2:-1*speed1,this.scaleX=-1):Math.abs(this.a.x)<.001&&Keyboard.getIsDown("RIGHT")?(this.v.x=Keyboard.getKeyDelay("RIGHT")<300?speed2:speed1,this.scaleX=1):this.v.x*=.9,0==this.v.y&&Keyboard.getIsDown("UP")&&(this.v.y=jumpSpeed,this.angle=0),0==this.v.y&&Keyboard.getIsDown("SPACE")?(this.playAction("attack"),this.idleTime=0):0!=this.v.y?(this.playAction("jump2"),this.idleTime=0):Math.abs(this.v.x)==speed1?this.playAction("run1"):Math.abs(this.v.x)==speed2?this.playAction("run2"):this.v.x<speed1&&this.playAction("idle")},Player.prototype.playAction=function(t){"idle"==t?(this.idleTime++,this.idleTime>IDLE_TIME?(this.idleTime>IDLE_TIME+100&&(this.idleAction=idleActions[Math.floor(Math.random()*idleActions.length)],this.idleTime=IDLE_TIME+1),this.play(this.idleAction)):this.play("stand2")):(this.idleTime=0,this.play(t))},Player.prototype.checkMap=function(t){if(t&&this.v.y>=0){this.angle=0;var i=t.mapData[this.pos.x>>0];if(i)for(var s=0,e=i.length;e>s;s++){var h=i[s];if(h.y<=this.pos.y+2&&h.y>=this.pos.y-5){this.pos.y=h.y,this.v.y=0,this.angle=h.ang;break}}}var i=t.wallData[this.pos.y-this.height+2>>0];if(t&&this.v.x>0){if(i)for(var s=0,e=i.length;e>s;s++){var a=i[s];if(a<=this.pos.x+.5*this.width&&a>=this.pos.x+.5*this.width-5)return this.pos.x=a-.5*this.width,this.v.x=0,void 0}}else if(t&&this.v.x<0&&i)for(var s=0,e=i.length;e>s;s++){var a=i[s];if(a<=this.pos.x-.5*this.width+5&&a>=this.pos.x-.5*this.width)return this.pos.x=a+.5*this.width,this.v.x=0,void 0}var i=t.wallData[this.pos.y-2>>0];if(t&&this.v.x>0){if(i)for(var s=0,e=i.length;e>s;s++){var a=i[s];if(a<=this.pos.x+.5*this.width&&a>=this.pos.x+.5*this.width-5)return this.pos.x=a-.5*this.width,this.v.x=0,void 0}}else if(t&&this.v.x<0&&i)for(var s=0,e=i.length;e>s;s++){var a=i[s];if(a<=this.pos.x-.5*this.width+5&&a>=this.pos.x-.5*this.width)return this.pos.x=a+.5*this.width,this.v.x=0,void 0}},Player.prototype.die=function(){this.alive=!1;var t=this;setTimeout(function(){t.alive=!0,t.alpha=1},2e3)},Player.prototype.checkFloors=function(t){if(this.v.y>=0)for(var i=0,s=t.length;s>i;i++){var e=t[i];if(this.bounds.left<e.x+e.width&&this.bounds.right>e.x&&e.pos.y<=this.pos.y+2&&e.pos.y>=this.pos.y-5)return this.pos.y=e.pos.y,this.v.y=0,this.floorV=e.v.x,void 0}this.floorV=0},Player.prototype.checkSprings=function(t){if(this.v.y>0)for(var i=0,s=t.length;s>i;i++){var e=t[i];if(!e.isJump&&this.bounds.left<e.x+e.width&&this.bounds.right>e.x&&e.pos.y-e.height<=this.pos.y+2&&e.pos.y-e.height>=this.pos.y-5)return e.jump(this),this.spring=e,void 0}},Player.prototype.update=function(){this.bounds=this.getBounds(),this.v.plus(this.a),this.v.y>maxSpeed&&(this.v.y=maxSpeed),this.v.x>speed2&&(this.v.x=speed2),this.v.x<-1*speed2&&(this.v.x=-1*speed2),this.pos.plus(this.v),this.pos.x+=this.floorV,this.a.x*=.9,this.checkMap(ns.map),this.checkFloors(ns.floors),this.checkSprings(ns.springs),this.x=this.pos.x+ns.map.x,this.y=this.pos.y+ns.map.y,this.keyAction(),this.alive||(this.time++,this.alpha=this.time%10>5?1:0)},Player.create=function(t,i){var s=new Player;return s.init(),s.play("play1"),s.pos.set(t,i),s},function(win){var ns=FL.ns("billd");eval(FL.import("FL","Utils, MovieClip"));var speed=2,YellowBall=ns.YellowBall=function(){MovieClip.apply(this,arguments),this.pos=new Vector,this.v=new Vector(speed,0),this.a=new Vector(0,.2),this.alive=!0,this.onGround=!1};Utils.extends(YellowBall,MovieClip),YellowBall.prototype.init=function(){this.addAnimation("stand",[0,1],!0,2),this.time=0,this.setImg(R.images.yellow_ball,11,11),this.originX=this.width>>1,this.originY=this.height},YellowBall.prototype.doSth=function(){var t=Math.random();.005>t&&(this.v.x*=-1),.01>t&&(this.v.y=-5,this.onGround=!1)},YellowBall.prototype.update=function(){if(this.x=this.pos.x+ns.map.x,this.y=this.pos.y+ns.map.y,this.isInStage&&(this.bounds=this.getBounds(),this.time+=this.timeStep,this.v.plus(this.a),this.v.y>5&&(this.v.y=5),this.pos.plus(this.v),this.a.x=0,ns.map)){if(this.v.y>0)for(var t=0,i=ns.map.lines,s=i.length;s>t;t++){var e=i[t].getY(this.pos.x);if(e&&e<=this.pos.y+2&&e>=this.pos.y-5){this.pos.y=e,this.v.y=0,this.angle=i[t].getAngle(),this.a.x=.07*Math.sin(this.angle)*(Math.cos(this.angle)>0?1:-1),this.onGround=!0;break}}ns.map&&this.v.y>0&&this.onGround&&(this.onGround=!1,this.pos.minus(this.v),this.v.x*=-1,this.v.y=0),this.pos.x<this.width&&(this.pos.x=this.width,this.v.x=speed),this.pos.x>ns.map.width-this.width&&(this.pos.x=ns.map.width-this.width,this.v.x=-1*speed),this.doSth()}},YellowBall.create=function(t,i){var s=new YellowBall;return s.init(),s.play("stand"),s.pos.set(t||0,i||0),s}}(window),function(win){var ns=FL.ns("billd");eval(FL.import("FL","Utils, MovieClip"));var speed=.5,Snail=ns.Snail=function(){MovieClip.apply(this,arguments),this.alive=!0,this.pos=new Vector,this.v=new Vector(speed,0),this.a=new Vector(0,.2)};Utils.extends(Snail,MovieClip),Snail.prototype.init=function(){this.addAnimation("stand",[0,0,1],!0,1),this.time=0,this.setImg(R.images.snail,32,16),this.originX=this.width>>1,this.originY=this.height},Snail.prototype.doSth=function(){var t=Math.random();this.scaleX=this.v.x>0?1:-1,.002>t&&(this.v.x*=-1),.01>t&&(this.v.y=-.1)},Snail.prototype.checkMap=function(t){if(t&&this.v.y>0){var i=t.mapData[this.x-t.x>>0];if(i)for(var s=0,e=i.length;e>s;s++){var h=i[s];if(h.y<=this.pos.y+2&&h.y>=this.pos.y-5){this.pos.y=h.y,this.v.y=0,this.angle=h.ang,this.a.x=.07*Math.sin(this.angle)*(Math.cos(this.angle)>0?1:-1);break}}}},Snail.prototype.update=function(){this.time+=this.timeStep,this.v.plus(this.a),this.v.y>5&&(this.v.y=5),this.pos.plus(this.v),this.a.x=0,this.alive&&this.checkMap(ns.map),this.pos.x<this.width&&(this.pos.x=this.width,this.v.x=speed),this.pos.x>ns.map.width-this.width&&(this.pos.x=ns.map.width-this.width,this.v.x=-1*speed),this.x=this.pos.x+ns.map.x,this.y=this.pos.y+ns.map.y,this.alive&&this.doSth()},Snail.create=function(t,i){var s=new Snail;return s.init(),s.play("stand"),s.pos.set(t||0,i||0),s.update(),s}}(window),function(win){var ns=FL.ns("billd");eval(FL.import("FL","Utils, MovieClip"));var speed=1.5,Spider=ns.Spider=function(){MovieClip.apply(this,arguments),this.alive=!0,this.pos=new Vector,this.v=new Vector(speed,0),this.a=new Vector(0,.2),this.onGround=!1};Utils.extends(Spider,MovieClip),Spider.prototype.init=function(){this.addAnimation("stand","0-9",!0,6),this.time=0,this.setImg(R.images.spider,41,24),this.originX=this.width>>1,this.originY=this.height-5},Spider.prototype.doSth=function(){var t=Math.random();this.scaleX=this.v.x>0?1:-1,.002>t&&(this.v.x=-1*speed)},Spider.prototype.checkMap=function(t){if(t&&this.v.y>0){var i=t.mapData[this.x-t.x>>0];if(i)for(var s=0,e=i.length;e>s;s++){var h=i[s];if(h.y<=this.pos.y+2&&h.y>=this.pos.y-5){this.pos.y=h.y,this.v.y=0,this.angle=h.ang,this.a.x=.07*Math.sin(this.angle)*(Math.cos(this.angle)>0?1:-1),this.onGround=!0;break}}}t&&this.v.y>0&&this.onGround&&(this.onGround=!1,this.pos.minus(this.v),this.v.x*=-1,this.v.y=0)},Spider.prototype.attack=function(){this.scaleX=this.scaleY=1.4;var t=this;setTimeout(function(){t.scaleX=t.scaleY=1},300)},Spider.prototype.update=function(){this.x=this.pos.x+ns.map.x,this.y=this.pos.y+ns.map.y,this.isInStage&&(this.bounds=this.getBounds(),this.time+=this.timeStep,this.v.plus(this.a),this.v.y>5&&(this.v.y=5),this.pos.plus(this.v),this.a.x=0,this.alive&&this.checkMap(ns.map),this.pos.x<this.width&&(this.pos.x=this.width,this.v.x=speed),this.pos.x>ns.map.width-this.width&&(this.pos.x=ns.map.width-this.width,this.v.x=-1*speed),this.alive&&this.doSth())},Spider.create=function(t,i){var s=new Spider;return s.init(),s.play("stand"),s.pos.set(t||0,i||0),s.update(),s}}(window),function(win){var ns=FL.ns("billd");eval(FL.import("FL","Utils, MovieClip"));var speed=7,Fish=ns.Fish=function(){MovieClip.apply(this,arguments),this.alive=!0,this.pos=new Vector,this.v=new Vector(0,0),this.a=new Vector(0,.1)};Utils.extends(Fish,MovieClip),Fish.prototype.init=function(){this.addAnimation("move",[0,1,2,3],!0,4),this.time=0,this.setImg(R.images.fish,32,42),this.originX=0,this.originY=this.height>>1},Fish.prototype.update=function(){this.time+=this.timeStep,this.v.plus(this.a),this.pos.plus(this.v),this.pos.y>ns.map.height+this.height&&(this.v.y=-speed);var t=.8;this.scaleY=this.v.y>0?-t:t,this.scaleX=t,this.x=this.pos.x+ns.map.x,this.y=this.pos.y+ns.map.y},Fish.create=function(t,i){var s=new Fish;return s.init(),s.play("move"),s.pos.set(t||0,i||0),s.update(),s}}(window),function(win){var ns=FL.ns("billd");eval(FL.import("FL","Utils, MovieClip"));var speed=7,Bat=ns.Bat=function(){MovieClip.apply(this,arguments),this.alive=!0,this.pos=new Vector,this.v=new Vector(1,0),this.a=new Vector(0,0)};Utils.extends(Bat,MovieClip),Bat.prototype.init=function(){this.addAnimation("move",[0,1,2,3],!0,4),this.setImg(R.images.bat,71,48),this.setCenter(),this.time=0,this.state="move"},Bat.prototype.update=function(){if(this.target){if("move"==this.state){this.a=this.target.pos.minusNew(this.pos);var t=this.a.getLength();t=0==t?.001:t,this.a.setLength(50/t),this.a.rotate(.2),Math.random()<.01&&this.v.rotate(.1),10>t&&(this.state="idle",this.a.set(0,-.1),this.v.y=-1,this.v.x*=2)}else"idle"==this.state&&Math.abs(this.target.pos.x-this.pos.x)>300&&Math.random()<.01&&(this.state="move",this.a.set(0,0),this.v.set(0,0));this.v.plus(this.a),this.v.cut(5),this.pos.plus(this.v),this.scaleX=this.v.x>0?1:-1,this.x=this.pos.x+ns.map.x,this.y=this.pos.y+ns.map.y}},Bat.create=function(){var t=new Bat;return t}}(window),function(win){var ns=FL.ns("billd");eval(FL.import("FL","Utils, Bitmap"));var DOWN_SPEED=-.1,UP_SPEED=.1,BACK_SPEED=-.05,Spring=ns.Spring=function(t,i){Bitmap.call(this,t,i),this.pos=new Vector(t,i),this.isJump=!1};Utils.extends(Spring,Bitmap),Spring.prototype.jump=function(t){this.isJump=!0,this.vy=DOWN_SPEED,this.target=t},Spring.prototype.update=function(){this.isJump&&(this.scaleY+=this.vy,this.vy==DOWN_SPEED&&this.scaleY<.3&&(this.vy=UP_SPEED),this.vy==UP_SPEED&&this.scaleY>1.5&&(this.vy=BACK_SPEED,this.target.v.y=-13,this.target=null),this.vy==BACK_SPEED&&this.scaleY<1&&(this.scaleY=1,this.isJump=!1),this.target&&(this.target.v.y=0,this.target.pos.y=this.pos.y-this.height*this.scaleY)),this.x=this.pos.x+ns.map.x,this.y=this.pos.y+ns.map.y},Spring.create=function(t,i){var s=new Spring(t,i);return s.setImg(R.images.spring),s.originY=s.height,s}}(window),function(win){function draw(t,i){for(var s in i)arr=i[s],t.save(),"bezier"==s?(t.fillStyle="#000000",t.strokeStyle="#9966ff",arr.forEach(function(i){t.beginPath();var s=i.shift();t.moveTo(s[0].x,s[0].y),t.quadraticCurveTo(s[1].x,s[1].y,s[2].x,s[2].y),i.forEach(function(i){t.quadraticCurveTo(i[1].x,i[1].y,i[2].x,i[2].y)}),t.fill()})):"rect"==s&&arr.forEach(function(i){i.color.length>7&&(t.globalApha=Number("0x"+i.color.slice(-2))/255,i.color=i.color.slice(0,7)),t.fillStyle=i.color,t.fillRect(i.x,i.y,i.width,i.height),t.strokeRect(i.x,i.y,i.width,i.height)}),t.restore()}function drawDebug(t,i){t.beginPath(),t.strokeStyle="#ff0000",t.lineWidth=2,i.forEach(function(i){t.moveTo(i.p0.x,i.p0.y),t.lineTo(i.p1.x,i.p1.y)}),t.stroke(),t.fill()}function getLinesByBezier(t){for(var i=t.getPointsByTime(.01),s=[],e=1,h=i.length;h>e;e++)s.push(new Line(i[e-1],i[e]));return s}function createMapData(t){for(var i={},s={},e=0,h=t.length;h>e;e++){var a=t[e];if(a.p0.x>>0==a.p1.x>>0)for(var o=Math.min(a.p0.y,a.p1.y)>>0,n=Math.max(a.p0.y,a.p1.y)>>0,p=o;n>=p;p++)s[p]=s[p]||[],s[p].push(a.p0.x);else for(var r=a.createPoints(),p=0,l=r.length;l>p;p++)point=r[p],i[point.x]=i[point.x]||[],Math.abs(point.ang)>.5*Math.PI&&(point.ang+=Math.PI),i[point.x].push({y:point.y,ang:point.ang})}return log(s),{wall:s,ground:i}}var ns=FL.ns("billd");eval(FL.import("FL","Bitmap, Utils, Bezier, Line"));var Map=ns.Map=function(t,i){Bitmap.call(this,t,i),this.mapData={},this.lines=[]};Utils.extends(Map,Bitmap),Map.prototype.init=function(t,i){this.img=document.createElement("canvas"),this.ctx=this.img.getContext("2d"),this.img.width=t,this.img.height=i,this.setImg(this.img),this.lines=[];for(var s=mapData.hit,e=0,h=s.beziers.length;h>e;e++){var a=s.beziers[e];this.lines=this.lines.concat(getLinesByBezier(new Bezier(a[0],a[1],a[2],a[3])))}for(var e=0,h=s.lines.length;h>e;e++){var a=s.lines[e];this.lines.push(new Line(new Vector(a[0].x,a[0].y),new Vector(a[1].x,a[1].y)))}draw(this.ctx,mapData.shape),FL.getUrlParams().hit&&drawDebug(this.ctx,this.lines);var o=createMapData(this.lines);this.mapData=o.ground,this.wallData=o.wall}}(window),function(win){var ns=FL.ns("billd");eval(FL.import("ns","Spring, Spider, YellowBall, Floor, Fish")),eval(FL.import("FL","Bitmap"));var InstanceFactory=ns.InstanceFactory={create:function(t,i){var s;switch(t){case"spring":s=Spring.create(i.x,i.y),ns.springs.push(s);break;case"spider":s=Spider.create(i.x,i.y),ns.spiders.push(s);break;case"yellow_ball":s=YellowBall.create(i.x,i.y);break;case"floor":s=new Floor(i),ns.floors.push(s);break;case"fish":s=Fish.create(i.x,i.y),ns.fishs.push(s);break;case"star":s=new Bitmap(i.x,i.y,R.images.star),s.pos=new Vector(i.x,i.y),s.originX=s.originY=0,s.update=function(){if(this.x=ns.map.x+this.pos.x,this.y=ns.map.y+this.pos.y,ns.player.hitTestObject(this)){this.update=null;var t=this;TweenLite.to(this,1,{angle:11,scaleX:0,scaleY:0,x:578,y:12,onComplete:function(){ns.score+=10,t.parent.removeChild(t)}})}};break;case"door":ns.door=s=new Bitmap(i.x,i.y,R.images.door),s.pos=new Vector(i.x,i.y),s.originX=42.8,s.originY=45,s.setCenter(),s.update=function(){this.x=80-100*ns.map.x/ns.map.width,this.y=30-10*ns.map.y/ns.map.height,this.scaleX=this.scaleY=1+Math.pow(ns.bg.y/100,2),log(ns.bg.y),this.angle+=.08,ns.player.hitTestObject(this)};break;default:s=null}return s}}}(window),function(){function init(){map=ns.map=new Map,player=ns.player=Player.create(),map.init(mapData.map.width,mapData.map.height),camera=new Camera(0,0,width,height),map.y=-474.95,player.pos.x=mapData.mc.player[0].x,player.pos.y=mapData.mc.player[0].y,player.y=player.pos.y+map.y;var t=ns.bg=new FL.Bitmap;t.setImg(R.images.bg),t.visible=!0,bgSX=(t.width-width)/(map.width-width),bgSY=(t.height-height)/(map.height-height+420),t.update=function(){t.x=map.x*bgSX,t.y=Math.min(map.y*bgSY,0)},stage.addChild(t),stage.addChild(map),stage.addChild(player),mapData.mc.floor=mapData.floor;for(var i in mapData.mc)for(var s=mapData.mc[i]||[],e=0,h=s.length;h>e;e++){var a=InstanceFactory.create(i,s[e]);a&&stage.addChild(a)}stage.addChildAt(ns.door,1),stage.update=update}function update(){player.x>=Math.floor(.6*width)&&map.x>width-map.width?map.x=.6*width-player.pos.x:player.x<=.4*width&&map.x<0&&(map.x=.4*width-player.pos.x),player.y<=Math.ceil(.3*height)?map.y=.3*height-player.pos.y:player.y>=Math.floor(.7*height)&&map.y>height-map.height&&(map.y=.7*height-player.pos.y),player.pos.y>map.height&&!isShake&&(FL.Shake.shake(stage,.5,.03,"xy"),isShake=!0,setTimeout(function(){isShake=!1,map.y=200,map.x=0,player.die(),player.pos.x=player.x=mapData.mc.player[0].x,player.pos.y=player.y=mapData.mc.player[0].y},1e3)),player.pos.x<.5*player.width&&(player.pos.x=.5*player.width),player.pos.x>map.width-.5*player.width&&(player.pos.x=map.width-.5*player.width);for(var t=0,i=spiders.length;i>t;t++){var s=spiders[t];if(s.alive&&s.isInStage&&player.hitTestObject(s)){player.v.y>0?(player.v.y=-5,s.v.y=-4,s.v.x=0,s.scaleX=1,s.setCenter(),spiders.splice(spiders.indexOf(s),1),TweenLite.to(s,2,{scaleX:.8,scaleY:.8,angle:10,onComplete:function(){stage.removeChild(s)}}),s.alive=!1,ns.score+=5):player.alive&&(player.die(),s.attack(),player.v.set(0,0),player.a.x=s.pos.x>player.pos.x?-3:3,s.v.x*=(s.pos.x-player.pos.x)*s.v.x<0?1:-1,life--,FL.Shake.shake(stage,.5,.02,"xy"));break}}for(var t=0,i=fishs.length;i>t;t++){var e=fishs[t];if(player.hitTestObject(e)&&player.alive){player.die(),player.v.y=-4,player.a.x=player.v.x>0?-3:3,FL.Shake.shake(stage,.5,.02,"xy");break}}lifeDom.innerHTML="life:"+life,scoreDom.innerHTML="score:"+ns.score}var ns=FL.ns("billd");eval(FL.import("ns","Player, Map, YellowBall, Spider, Fish, Floor, Bat, Spring, InstanceFactory")),eval(FL.import("FL","Stage, LoadProgress, ImageLoader, Camera"));var lifeDom=document.querySelector("#life"),scoreDom=document.querySelector("#score"),canvas=document.querySelector("canvas"),width=600,height=300,fps=60,mc,life=99;ns.score=0;var stage=new Stage(canvas,width,height,fps);stage.start();var isShake=!1,loadProgress=new LoadProgress(new ImageLoader);loadProgress.x=width>>1,loadProgress.y=height>>1,loadProgress.addEventListener("complete",function(){stage.removeChild(this),this.removeAllEventListener("complete",arguments.callee),loadProgress=null,R.images=this.loader.images,init()}),loadProgress.load(R.images),stage.addChild(loadProgress),stage.initKeyboardEvent();var map,player,camera,spiders=ns.spiders=[],fishs=ns.fishs=[],floors=ns.floors=[],springs=ns.springs=[];setInterval(function(){stage.render()},1e3/fps)}();
//@ sourceMappingURL=game.min.js.map